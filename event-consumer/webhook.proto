syntax = "proto3";

package event_consumer;

import "google/protobuf/timestamp.proto";


service WebhookService {
  rpc SubscribeWebhook (SubscribeWebhookRequest) returns (SubscribeWebhookResponse) {}
  rpc SubscribeWebhooks (SubscribeWebhooksRequest) returns (SubscribeWebhooksResponse) {}
  rpc FindAllTypes (Empty) returns (WebhooksResponse) {}
  rpc FindAll (FindAllRequest) returns (FindAllResponse) {}
  rpc UnsubscribeWebhook (UnsubscribeWebhookRequest) returns (UnsubscribeWebhookResponse) {}
  rpc UpdateEndpoint (UpdateEndpointRequest) returns (UpdateEndpointResponse) {}
  rpc SendTest (SendTestRequest) returns (SendTestResponse) {}
}

message FindAllRequest {
  string userId = 1;
}

message FindAllResponse {
  repeated UrlsResponse urls = 1;
}

message UrlsResponse {
  string url = 1;
  repeated WebhookResponse webhooks = 2;
}

message SubscribeWebhookRequest {
  string userId = 1;
  string webhookId = 2;
  string url = 3;
}

message SubscribeWebhookResponse {
  string userId = 1;
  WebhookResponse webhook = 2;
}

message SubscribeWebhooksRequest {
  string userId = 1;
  string url = 2;
}

message SubscribeWebhooksResponse {
  string userId = 1;
  repeated WebhookResponse webhooks = 2;
}

message UnsubscribeWebhookRequest {
  string userId = 1;
  string webhookId = 2;
  string url = 3;
}

message WebhookResponse {
  string id = 1;
  string topic = 2;
  repeated string urls = 3;
  bool subscribed = 4;
}

message WebhooksResponse {
	repeated WebhookResponse webhooks = 1;
}

message UnsubscribeWebhookResponse {

}

message UpdateEndpointRequest {
  string userId = 1;
  repeated WebhookUpdateEndpointRequest webhooks = 2;
  string url = 3;
}

message UpdateEndpointResponse {

}

message WebhookUpdateEndpointRequest {
  string topic = 1;
  bool subscribe = 2;
}

message SendTestRequest {
  string topic = 1;
  string userId = 2;
  string url = 3;
}

message SendTestResponse {

}

message Empty {}
